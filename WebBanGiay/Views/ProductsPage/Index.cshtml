@using WebBanGiay.Models.ViewModels;
@model ProductsListViewModel


@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Shop Start -->
<div class="container-fluid pt-5">
    <div class="row px-xl-5">
        <!-- Shop Sidebar Start -->
        <div class="col-lg-3 col-md-12">
            <!-- Price Start -->
            <div class="border-bottom mb-4 pb-4">
                <h5 class="font-weight-semi-bold mb-4">Tìm kiếm theo giá</h5>
                <form id="form-filter-price">
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="All" checked id="price-all">
                        <label class="custom-control-label" for="price-all">Tất cả</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="0-100000" id="price-1">
                        <label class="custom-control-label" for="price-1">0 - 100k</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="100000-200000" id="price-2">
                        <label class="custom-control-label" for="price-2">100k - 200k</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="200000-300000" id="price-3">
                        <label class="custom-control-label" for="price-3">200k - 300k</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="300000-400000" id="price-4">
                        <label class="custom-control-label" for="price-4">300k - 400k</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="400000-500000" id="price-5">
                        <label class="custom-control-label" for="price-5">400k - 500k</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between">
                        <input type="checkbox" class="custom-control-input" val="500000-700000" id="price-6">
                        <label class="custom-control-label" for="price-6">500k - 700k</label>
                   
                    </div>
                </form>
            </div>
            <!-- Price End -->
            <!-- Color Start -->
            <div class="border-bottom mb-4 pb-4">
                <h5 class="font-weight-semi-bold mb-4">Tìm kiếm theo màu</h5>
                <form id="form-filter-color">
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="All" checked id="color-all">
                        <label class="custom-control-label" for="color-all">Tất cả</label>
                       
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="Đen" id="color-1">
                        <label class="custom-control-label" for="color-1">Đen</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="Xám" id="color-2">
                        <label class="custom-control-label" for="color-2">Xám</label>
                       
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="Trắng" id="color-3">
                        <label class="custom-control-label" for="color-3">Trắng</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="Hồng" id="color-4">
                        <label class="custom-control-label" for="color-4">Hồng</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between">
                        <input type="checkbox" class="custom-control-input" val="Xanh" id="color-5">
                        <label class="custom-control-label" for="color-5">Xanh</label>
                        
                    </div>
                </form>
            </div>
            <!-- Color End -->
            <!-- Size Start -->
            <div class="mb-5">
                <h5 class="font-weight-semi-bold mb-4">Tìm kiếm theo kích cỡ</h5>
                <form id="form-filter-size">
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="All" checked id="size-all">
                        <label class="custom-control-label" for="size-all">Tất cả</label>
                  
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="36" id="size-1">
                        <label class="custom-control-label" for="size-1">36</label>
                     
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="37" id="size-2">
                        <label class="custom-control-label" for="size-2">37</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="38" id="size-3">
                        <label class="custom-control-label" for="size-3">38</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="39" id="size-4">
                        <label class="custom-control-label" for="size-4">39</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="40" id="size-5">
                        <label class="custom-control-label" for="size-5">40</label>
                        
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" val="41" id="size-6">
                        <label class="custom-control-label" for="size-6">41</label>
                       
                    </div>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between">
                        <input type="checkbox" class="custom-control-input" val="42" id="size-7">
                        <label class="custom-control-label" for="size-7">42</label>
                        
                    </div>
                </form>
                <button id="btn-filter" type="submit" class="btn">Tìm kiếm </button>
            </div>
            <!-- Size End -->
        </div>
        <!-- Shop Sidebar End -->
        <!-- Shop Product Start -->
        <div class="col-lg-9 col-md-12">
            <div class="row pb-3" id="filtered-products">
                @if (ViewBag.ProductQuantity <= 9)
                {

                    foreach (var item in Model.Products)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12 pb-1">
                            <div class="card product-item border-0 mb-4">
                                <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                                    <img class="img-fluid w-100" src="~/img/@item.ProductImage" alt="">
                                </div>
                                <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                                    <h6 class="text-truncate mb-3">@item.ProductName</h6>
                                    <div class="d-flex justify-content-center">
                                        <h6>@(Math.Round(item.ProductPrice * (1 - item.ProductDiscount)).ToString("000,0"))₫</h6><h6 class="text-muted ml-2"><del>@(Math.Round(item.ProductPrice).ToString("000,0"))₫</del></h6>
                                    </div>
                                </div>
                                <div class="card-footer d-flex justify-content-between bg-light border">
                                    <a href="/ProductsPage/Details?id=@item.ProductId" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>Xem chi tiết</a>
                                    <a href="/Cart/AddToCart/?productId=@item.ProductId" class="btn btn-sm text-dark p-0"><i class="fas fa-shopping-cart text-primary mr-1"></i>Thêm vào giỏ hàng</a>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    foreach (var item in Model.Products)
                    {
                        <div class="col-lg-4 col-md-6 col-sm-12 pb-1">
                            <div class="card product-item border-0 mb-4">
                                <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                                    <img class="img-fluid w-100" src="~/img/@item.ProductImage" alt="">
                                </div>
                                <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                                    <h6 class="text-truncate mb-3">@item.ProductName</h6>
                                    <div class="d-flex justify-content-center">
                                        <h6>@(Math.Round(item.ProductPrice * (1 - item.ProductDiscount)).ToString("000,0"))₫</h6><h6 class="text-muted ml-2"><del>@(Math.Round(item.ProductPrice).ToString("000,0"))₫</del></h6>
                                    </div>
                                </div>
                                <div class="card-footer d-flex justify-content-between bg-light border">
                                    <a href="/ProductsPage/Details?id=@item.ProductId" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>Xem chi tiết</a>
                                    <a href="/Cart/AddToCart/?productId=@item.ProductId" class="btn btn-sm text-dark p-0"><i class="fas fa-shopping-cart text-primary mr-1"></i>Thêm vào giỏ hàng</a>
                                </div>
                            </div>
                            
                        </div>
                    }
                    <div class="col-12 pb-1">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center mb-3">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                                @if (ViewBag.KeyWords == null)
                                {
                                    for (int i = 1; i <= Model.PagingInfo.TotalPages; i++)
                                    {
                                        if (Model.PagingInfo.CurrentPage == @i)
                                        {
                                            <li class="page-item active"><a class="page-link" href="/ProductsPage/?productPage=@i">@i</a></li>
                                        }
                                        else
                                        {
                                            <li class="page-item"><a class="page-link" href="/ProductsPage/?productPage=@i">@i</a></li>
                                        }
                                    }
                                }
                                else
                                {
                                    for (int i = 1; i <= Model.PagingInfo.TotalPages; i++)
                                    {
                                        if (Model.PagingInfo.CurrentPage == @i)
                                        {
                                            <li class="page-item active"><a class="page-link" href="/ProductsPage/Search?productPage=@i">@i</a></li>
                                        }
                                        else
                                        {
                                            <li class="page-item"><a class="page-link" href="/ProductsPage/Search?keyWords=@ViewBag.KeyWords&productPage=@i">@i</a></li>
                                        }
                                    }
                                }

                                <li class="page-item">
                                    <a class="page-link" href="#" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                }
            </div>
            
        </div>
        <!-- Shop Product End -->
       
        
    </div>
</div>

<style>
    #btn-filter {
        display: flex;
        margin-left: auto;
        margin-right: auto;
        margin-top: 30px;
        background-color: #D19C97;
        color: #fff;
        padding: 8px 32px;
        border-radius: 8px;
        border: none;
    }
</style>
<!-- Shop End -->
<script>
    document.getElementById('btn-filter').addEventListener("click", function () {
        var priceRange = getSelectedCheckboxes('form-filter-price');
        var colors = getSelectedCheckboxes('form-filter-color');
        var sizes = getSelectedCheckboxes('form-filter-size');
        var data = {
            PriceRange: priceRange,
            Colors: colors,
            Sizes: sizes
        }
        console.log(data);
        fetch('/ProductsPage/GetFilteredProducts', {
            method: 'POST',
            headers: {
                "Content-type": "application/json"
            },
            body: JSON.stringify(data)
        }
        ).then(
            function (response) {
                if (response.ok) {
                    return response.text();
                }
                else {
                    throw new Error("Error sending");
                }
            }
        ).then(function (results) {
            $("#filtered-products").html(results)
        })
            .catch(function (error) {
                console.log("An error occured: ", error);
            })

    })

    function getSelectedCheckboxes(formid) {
        var checkboxes = $('#' + formid + ' ' + 'input[type="checkbox"]:checked');
        var values = [];
        checkboxes.each(
            function () {
                values.push($(this).attr('val'));
            }
        )
        return values;
    }
</script>